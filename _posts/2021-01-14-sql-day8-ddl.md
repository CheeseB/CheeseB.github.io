---
title: "[SQL] Day8 - DDL"
categories:
- sql
tags:
- sql
- oracle
- database
classes: wide
---


## DDL (Data Definition Language: 데이터 정의어)


### DDL

- 데이터베이스 구조(객체)를 생성, 수정, 삭제하는 데 사용
- 실제 DB에 즉각 반영되며, DB사전에 정보를 기록함

- DDL 종류
	- CREATE
	- ALTER
	- DROP
	- RENAME
	- TRUNCATE

- 오라클에서 사용하는 객체
	- 테이블(Table)
	- 뷰(View)
	- 시퀀스(Sequence)
	- 인덱스(Index)
	- 동의어(Synonym)

- 스키마(schema): 특정 사용자가 DB에 접근해 생성한 객체들의 대표이름
	- 일반적으로 사용자의 계정명과 동일
	- 생성한 객체들은 생성한 계정이 소유하며, 다른 스키마는 기본적으로 접근이 불가함 (권한 할당 필요)
	- 권한을 가진 사용자가 다른 스키마에 접근하기 위해선 '스키마.객체명' 형식으로 접근해야 함

```sql
SELECT * FROM scott.dept; -- 스키마.객체명
```


### CREATE: 테이블 생성

- DB객체 이름 지정방법
	- 테이블, 컬럼명은 문자로 시작하며 1 ~ 30자 이내로 작성(30byte)
	- 테이블, 컬럼명은 영어 대소문자, 숫자, 특수문자(_,$,#) 로만 작성
		- 한글 작성도 가능하지만 권장하지 않음
	- 동일한 사용자의 다른 객체와 이름이 중복되면 안됨
	- 예약어 사용 불가
	- 대소문자 구분 안함

```sql
CREATE TABLE 테이블명
(컬럼명	데이터타입,
 컬럼명	데이터타입,
 ...);
```

```sql
CREATE TABLE employee
(empno      NUMBER(4),
 ename      VARCHAR2(20),
 hiredate   DATE,
 sal        NUMBER(7,2));
```

- 데이터 타입 종류
	- VARCHAR는 CHAR와 달리 쓴 글자 길이에 따라 차지하는 공간이 맞춰짐. 괄호안의 숫자는 최대길이

<img src="{{site.url}}/assets/img/post/sql9.jpg">

```sql
-- ROWID를 이용한 행 검색
SELECT ROWID, deptno
FROM dept;

SELECT *
FROM dept
WHERE ROWID = 'AAAE5cAAEAAAAFMAAA';
```

- DEFAULT: 해당 컬럼에 값을 지정하지 않으면 자동으로 디폴트값이 입력됨
	- NULL값이 저장되는 것을 방지

```sql
-- 일반 컬럼 --
CREATE TABLE def_table1
(num        NUMBER(2),
 writeday   DATE);

INSERT INTO def_table1(num)
VALUES(20); -- 20, (null)

INSERT INTO def_table1(num, writeday)
VALUES(2, DEFAULT); -- 2, (null)

-- DEFAULT 적용 컬럼 --
CREATE TABLE def_table2
(num        NUMBER(2),
 writeday   DATE DEFAULT SYSDATE);

INSERT INTO def_table2(num)
VALUES(20); -- 20, 21/01/14

INSERT INTO def_table2(num, writeday)
VALUES(2, DEFAULT); -- 2, 21/01/14
```

- 서브쿼리를 이용한 테이블 생성
	- CTAS라고 함
	- 지정된 컬럼의 개수와 서브쿼리에서 리턴된 컬럼 개수가 일치해야 함
	- 새로 생성된 테이블에 컬럼, 컬럼의 데이터 타입, 데이터들이 복사되지만 not null을 제외한 제약 조건은 복사되지 않음 (Primary Key 등)

```sql
-- 그대로 복사 --
CREATE TABLE deptA
AS
SELECT *
FROM dept;

-- 컬럼명 바꾸기 --
CREATE TABLE deptB(no, name)
AS
SELECT deptno, dname
FROM dept;

-- 데이터 복사 안함 --
CREATE TABLE deptC
AS
SELECT *
FROM dept
WHERE 1=2;
```


### 제약조건 정의

- 부적절한 자료가 입력되는 것을 방지
- 테이블레벨 및 컬럼레벨에서 규칙을 적용하며, 테이블에서 행이 삽입/갱신/삭제될 때마다 규칙이 적용됨
	- not null은 무조건 컬럼 레벨에서만 규칙 적용됨 (테이블레벨X)
- 종속성이 존재할 경우 테이블 삭제를 방지함
- 일시적으로 DISABLE/ENABLE 할 수도 있음
- 제약조건 이름은 '테이블명_컬럼명_제약종류(PK/FK 등)' 이렇게 짓는것을 권장

<img src="{{site.url}}/assets/img/post/sql10.jpg">

```sql
-- 컬럼 레벨
CREATE TABLE 테이블명
(컬럼명 데이터타입 CONSTRAINT 제약조건명 제약종류,
 ...);

-- 테이블 레벨
CREATE TABLE 테이블명
(컬럼명 데이터타입,
 ...,
 CONSTRAINT 제약조건명 제약종류(컬럼명))
```

- USER_CONSTRAINTS 데이터 사전을 조회하면 테이블의 제약조건 확인 가능

```sql
SELECT *
FROM USER_CONSTRAINTS
WHERE table_name IN('DEPARTMENT'); -- 테이블명 대문자로 써야함
```

- Primary Key(PK): 테이블에 대한 기본키 생성
	- 중복 불가, null 불가(UNIQUE + NOT NULL)
	- 각 행을 유일하게 식별함
	- 하나의 기본키만 테이블에 존재 가능

```sql
CREATE TABLE department
(deptno NUMBER(2) CONSTRAINT department_deptno_pk PRIMARY KEY,
 dname  VARCHAR2(15),
 loc    VARCHAR2(15));

INSERT INTO department VALUES(10, '인사과', '서울');
INSERT INTO department VALUES(10, '영업', '서울'); -- error!
INSERT INTO department VALUES(NULL, '영업', '서울'); -- error!
```

```sql
-- 컬럼 레벨
CREATE TABLE pk_tab1
(id     NUMBER(2) CONSTRAINT pk_tab1_id_pk PRIMARY KEY,
 name   VARCHAR2(10));

-- 테이블 레벨
CREATE TABLE pk_tab2
(id     NUMBER(2),
 name   VARCHAR(10),
 CONSTRAINT pk_tab2_id_pk PRIMARY KEY(id));
```
