{"componentChunkName":"component---src-templates-post-template-tsx","path":"/mysql/sql-subquery/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>학습 정리</h2>\n<h3>서브쿼리</h3>\n<ul>\n<li>\n<p>서브쿼리: SELECT문 안에 또다른 SELECT문이 포함되어 있는것</p>\n<ul>\n<li>하나의 중첩된 SELECT 문으로 여러번의 SELECT문을 수행한 결과를 얻음</li>\n</ul>\n</li>\n<li>\n<p>서브쿼리 특징</p>\n<ul>\n<li>서브쿼리가 먼저 실행되고, 그 결과가 메인 쿼리에 전달되어 실행됨</li>\n<li>메인쿼리에서 서브쿼리 안의 컬럼을 사용할순 없음</li>\n<li>SELECT 뿐 아니라 FROM, WHERE, HAVING, ORDER BY, UPDATE, INSERT INTO 절에도 사용 가능</li>\n<li>서브쿼리엔 반드시 괄호를 써야하며, 서브쿼리 안에선 ORDER BY절 사용 불가함</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> ename <span class=\"token operator\">=</span> <span class=\"token string\">'SMITH'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">-- 800</span>\r\n\r\n<span class=\"token keyword\">SELECT</span> ename<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> sal <span class=\"token operator\">&lt;</span> <span class=\"token number\">800</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">-- 위 두개의 쿼리문을 합친 결과</span>\r\n\r\n<span class=\"token keyword\">SELECT</span> ename<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> sal <span class=\"token operator\">&lt;</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> sal\r\n             <span class=\"token keyword\">FROM</span> emp\r\n             <span class=\"token keyword\">WHERE</span> ename <span class=\"token operator\">=</span> <span class=\"token string\">'SMITH'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>서브쿼리 종류\n<ul>\n<li>실행 결과 개수에 따라\n<ul>\n<li>단일행 서브쿼리</li>\n<li>복수행 서브쿼리</li>\n<li>다중컬럼 서브쿼리</li>\n</ul>\n</li>\n<li>서브쿼리 위치에 따라\n<ul>\n<li>일반 서브쿼리</li>\n<li>인라인뷰 (FROM절에 위치)</li>\n<li>상관 서브쿼리 (일반적으로 SELECT절에 위치)</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3>단일행 서브쿼리</h3>\n<ul>\n<li>단일행 서브쿼리: 서브쿼리가 한개의 행을 리턴\n<ul>\n<li>반드시 단일행 연산자를 사용해야 함(=, >, &#x3C;, >=, &#x3C;=, !=)</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> ename<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> sal <span class=\"token operator\">></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">AVG</span><span class=\"token punctuation\">(</span>sal<span class=\"token punctuation\">)</span>\r\n             <span class=\"token keyword\">FROM</span> emp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>하나의 메인 쿼리에 여러개의 서브쿼리 사용 가능</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> ename<span class=\"token punctuation\">,</span> job<span class=\"token punctuation\">,</span> hiredate<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> job <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> job\r\n             <span class=\"token keyword\">FROM</span> emp\r\n             <span class=\"token keyword\">WHERE</span> empno <span class=\"token operator\">=</span> <span class=\"token number\">7521</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token operator\">AND</span> sal <span class=\"token operator\">></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> sal\r\n             <span class=\"token keyword\">FROM</span> emp\r\n             <span class=\"token keyword\">WHERE</span> empno <span class=\"token operator\">=</span> <span class=\"token number\">7934</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>HAVING 절에도 서브쿼리 사용 가능</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> deptno<span class=\"token punctuation\">,</span> <span class=\"token function\">MIN</span><span class=\"token punctuation\">(</span>sal<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> deptno\r\n<span class=\"token keyword\">HAVING</span> <span class=\"token function\">MIN</span><span class=\"token punctuation\">(</span>sal<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">MIN</span><span class=\"token punctuation\">(</span>sal<span class=\"token punctuation\">)</span>\r\n                  <span class=\"token keyword\">FROM</span> emp\r\n                  <span class=\"token keyword\">WHERE</span> deptno <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 'SALES' 부서의 인원수보다 적은 부서의 부서명, 인원수 검색</span>\r\n<span class=\"token keyword\">SELECT</span> d<span class=\"token punctuation\">.</span>dname<span class=\"token punctuation\">,</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">FROM</span> emp e<span class=\"token punctuation\">,</span> dept d\r\n<span class=\"token keyword\">WHERE</span> e<span class=\"token punctuation\">.</span>deptno <span class=\"token operator\">=</span> d<span class=\"token punctuation\">.</span>deptno\r\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> d<span class=\"token punctuation\">.</span>dname\r\n<span class=\"token keyword\">HAVING</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\r\n                   <span class=\"token keyword\">FROM</span> emp e <span class=\"token keyword\">NATURAL</span> <span class=\"token keyword\">JOIN</span> dept d\r\n                   <span class=\"token keyword\">WHERE</span> d<span class=\"token punctuation\">.</span>dname <span class=\"token operator\">=</span> <span class=\"token string\">'SALES'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>복수행 서브쿼리</h3>\n<ul>\n<li>복수행 서브쿼리: 서브쿼리가 여러개의 행을 리턴\n<ul>\n<li>반드시 복수행 연산자를 사용해야 함(IN, ANY, ALL, EXISTS)</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> ename<span class=\"token punctuation\">,</span> deptno<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> deptno <span class=\"token operator\">IN</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> deptno\r\n                <span class=\"token keyword\">FROM</span> emp\r\n                <span class=\"token keyword\">WHERE</span> sal <span class=\"token operator\">>=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>IN: 서브쿼리 결과 중 하나라도 일치하면 됨</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 업무별로 최소급여를 받는 사원의 정보 출력</span>\r\n<span class=\"token keyword\">SELECT</span> empno<span class=\"token punctuation\">,</span> ename<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> sal <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">MIN</span><span class=\"token punctuation\">(</span>sal<span class=\"token punctuation\">)</span>\r\n              <span class=\"token keyword\">FROM</span> emp\r\n              <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> job<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>ALL: 서브쿼리의 결과 모두에 대해서 조건을 만족해야 함\n<ul>\n<li>부등호 조건에 사용</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> empno<span class=\"token punctuation\">,</span> ename<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> sal <span class=\"token operator\">></span> <span class=\"token keyword\">ALL</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> sal\r\n                <span class=\"token keyword\">FROM</span> emp\r\n                <span class=\"token keyword\">WHERE</span> job <span class=\"token operator\">=</span> <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>ANY: 서브쿼리의 결과 중 하나에 대해서만 조건을 만족해도 됨\n<ul>\n<li>부등호 조건에 사용</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> empno<span class=\"token punctuation\">,</span> ename<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> sal <span class=\"token operator\">></span> <span class=\"token keyword\">ANY</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> sal\r\n                <span class=\"token keyword\">FROM</span> emp\r\n                <span class=\"token keyword\">WHERE</span> job <span class=\"token operator\">=</span> <span class=\"token string\">'MANAGER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>EXISTS: 서브쿼리의 결과가 존재하는지 여부를 확인\n<ul>\n<li>결과가 하나도 없으면 조건이 거짓이 되어, 선택되는 레코드가 없음</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span>\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">EXISTS</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> empno\r\n             <span class=\"token keyword\">FROM</span> emp\r\n             <span class=\"token keyword\">WHERE</span> comm <span class=\"token operator\">IS</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>다중 컬럼 서브쿼리</h3>\n<ul>\n<li>\n<p>다중 컬럼 서브쿼리: 서브쿼리에서 여러개의 컬럼값을 검색하여 메인쿼리의 조건절과 비교함</p>\n<ul>\n<li>메인쿼리의 조건절에서도 서브쿼리 컬럼수만큼 지정해야함</li>\n</ul>\n</li>\n<li>\n<p>비교 방법</p>\n<ul>\n<li>Pairwise: 컬럼을 쌍으로 묶어서 동시에 비교</li>\n<li>Unpairwise: 컬럼별로 나누어서 비교 후 AND 연산 처리</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 부서별로 가장 많은 sal을 받는 사원정보 출력</span>\r\n\r\n<span class=\"token comment\">-- Pairwise</span>\r\n<span class=\"token keyword\">SELECT</span> deptno<span class=\"token punctuation\">,</span> empno<span class=\"token punctuation\">,</span> ename<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> <span class=\"token punctuation\">(</span>deptno<span class=\"token punctuation\">,</span> sal<span class=\"token punctuation\">)</span> <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> deptno<span class=\"token punctuation\">,</span> <span class=\"token function\">MAX</span><span class=\"token punctuation\">(</span>sal<span class=\"token punctuation\">)</span>\r\n                        <span class=\"token keyword\">FROM</span> emp\r\n                        <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">-- Unpairwise</span>\r\n<span class=\"token keyword\">SELECT</span> deptno<span class=\"token punctuation\">,</span> empno<span class=\"token punctuation\">,</span> ename<span class=\"token punctuation\">,</span> sal\r\n<span class=\"token keyword\">FROM</span> emp\r\n<span class=\"token keyword\">WHERE</span> deptno <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> deptno\r\n\t\t\t\t <span class=\"token keyword\">FROM</span> emp\r\n\t\t\t\t <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> deptno<span class=\"token punctuation\">)</span>\r\n<span class=\"token operator\">AND</span> sal <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token function\">MAX</span><span class=\"token punctuation\">(</span>sal<span class=\"token punctuation\">)</span>\r\n\t\t\t<span class=\"token keyword\">FROM</span> emp\r\n\t\t\t<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> deptno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>인라인 뷰</h3>\n<ul>\n<li>인라인 뷰: FROM절 뒤에 테이블명 대신 서브쿼리가 사용됨\n<ul>\n<li>하나의 가상 테이블을 반환</li>\n<li>서브쿼리 내의 컬럼을 메인쿼리에서 사용 가능</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> e<span class=\"token punctuation\">.</span>deptno<span class=\"token punctuation\">,</span> total_sum<span class=\"token punctuation\">,</span> cnt\r\n<span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> deptno<span class=\"token punctuation\">,</span> <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>sal<span class=\"token punctuation\">)</span> total_sum<span class=\"token punctuation\">,</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> cnt\r\n      <span class=\"token keyword\">FROM</span> emp\r\n      <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> deptno<span class=\"token punctuation\">)</span> e<span class=\"token punctuation\">,</span> dept d\r\n<span class=\"token keyword\">WHERE</span> e<span class=\"token punctuation\">.</span>deptno <span class=\"token operator\">=</span> d<span class=\"token punctuation\">.</span>deptno<span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"[SQL] Day6 - 서브쿼리","summary":"SQL 공부","date":"2021.01.12.","categories":["MySQL"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/webp;base64,UklGRoAAAABXRUJQVlA4IHQAAABwAgCdASoUAAkAAAAAJaQAcDMRhWZlauyGxpAAAP7//74zH3Ve+xCCd98GszB/Tj/iCC0Y2MSrtOrVqfjkmZnssmfzGf/7KOlv13d2hD+q/kdssoK/ffHEQhDODPXwu78YeMXjLLfvfkHHrf9jjPyHNsAAAA=="},"images":{"fallback":{"src":"/static/1fc3bdde82b8ae2d4fcc21fd217faf9f/7713b/mysql.webp","srcSet":"/static/1fc3bdde82b8ae2d4fcc21fd217faf9f/35fd3/mysql.webp 293w,\n/static/1fc3bdde82b8ae2d4fcc21fd217faf9f/cd395/mysql.webp 585w,\n/static/1fc3bdde82b8ae2d4fcc21fd217faf9f/7713b/mysql.webp 1170w","sizes":"(min-width: 1170px) 1170px, 100vw"},"sources":[]},"width":1170,"height":510.99999999999994}},"publicURL":"/static/1fc3bdde82b8ae2d4fcc21fd217faf9f/mysql.webp"}}}}]}},"pageContext":{"slug":"/mysql/sql-subquery/"}},"staticQueryHashes":["2269898903"],"slicesMap":{}}